<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>My DDC object</title>
  <meta name="description" content="A simple HTML file for my DDC object.">
  <script type="text/javascript" src="util/messagingUtil.js"></script>
  <script type="text/javascript" src="util/jobExecutionUtil.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.1.min.js" integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous"></script>
  <!-- CSS only -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css"
    integrity="sha512-xh6O/CkQoPOWDdYTDqeRdPCVd1SpvCA9XXcUnZS2FmJNp1coAFzvtCN9BmamE+4aHK8yyUHUSCcJHgXloTyT2A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<style>
  .checked {
    color: orange;
  }
</style>

<body>
  <form id="evaluation" class="container"></form>
  <script>

    document.addEventListener('DOMContentLoaded', function () {
            va.messagingUtil.setOnDataReceivedCallback(onDataReceived);
        });

    let data_temp=[]
    function onDataReceived(resultData) {
        if (!resultData) return;

        // console.log(resultData)
        // data_temp = resultData["data"]
        // console.log("Inside the Ondatarecd function")
        // console.log(data_temp)
        // console.log("end inside")

        data_temp = resultData["data"]
        console.log(resultData)
        v0_label = String(resultData["columns"][0]["label"])
        v1_label = String(resultData["columns"][1]["label"])
        v2_label = String(resultData["columns"][2]["label"])
        console.log(v0_label)
        console.log(v1_label)
        console.log(v2_label)
        let va_data = []

        console.log(resultData["availableRowCount"])
        for (let i = 0; i < resultData["availableRowCount"]; i++){
        let temp_dict = {};
        temp_dict["id"]=data_temp[i][0]
        temp_dict["name"]=data_temp[i][1]
        temp_dict["status"]=data_temp[i][2]
        va_data.push(temp_dict);
        }
        const fruit_data = ['Apple','Banana','Cherry']

        // va_data[resultData["availableRowCount"]] = va_data[resultData["availableRowCount"]-1]

        // const rotateArray1 = function(nums, k) {
        // for (let i = 0; i < k; i++) {
        //     nums.unshift(nums.pop());
        // }
        // return nums;
        // }

        // va_data=rotateArray1(va_data,4)
        console.log(fruit_data)
        SubmitForm(fruit_data);
    }

function SubmitForm(input_data) {
    const displayForm = (input_data) => {
      // Generate the different form elements using the VA data
      const formElements = input_data.columns.map((fruit, index) => {
        return `Fruit: ${fruit}, Index: ${index}`;
      })
      formElements.push('<div class="row m-3"><button id="submitButton" type="submit" class="col btn btn-primary">Submit</button></div>')
      $("#evaluation").html(formElements.join(""))
      $("#submitButton").on("click", (event) => {
        event.preventDefault()
        const url = "https://canada.viya4.sasdemo.ca"
        const parameters = {
          "_program": "/Public/ChrisS/IRCC_va/save_data_from_VA",
        }

        // hard_data = [
        // {id: 1278, name: 'William H. Smithson', status: 'R'},
        // {id: 1477, name: 'Wilson B. Smithson', status: 'R'},
        // {id: 7599, name: 'Bill RW. Smithson', status: 'W'},
        // {id: 7993, name: 'Charles Smith', status: 'W'},
        // ]
        executeJob(url, input_data, parameters).then(response => console.log(response))

        // executeJob(url, input_data, parameters).then(response => console.log(response))

      })
    }

    va.messagingUtil.setOnDataReceivedCallback(displayForm)
}

  </script>
</body>

</html>